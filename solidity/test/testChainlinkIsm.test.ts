import { expect } from 'chai';
import { Wallet } from 'ethers';
import { ethers } from 'hardhat';

import { utils } from '@hyperlane-xyz/utils';

import { MultisigCcipReadIsm, MultisigCcipReadIsm__factory } from '../types';

describe('TestCcipReadIsm', () => {
  let ism: MultisigCcipReadIsm;

  before(async () => {
    const [signer] = await ethers.getSigners();
    const factory = new MultisigCcipReadIsm__factory(signer);
    ism = await factory.deploy();
  });

  it('verifies in JS', async () => {
    const report =
      '0x000000000000000000000008afbcf24ae1efc261fa46eec78190490000931605121a171b0f0d0c060004131108101c0507141903020b1d0e150a0118161e09000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000001f0000000000000000000000000000000000000000000000000000002ba3627f4a0000000000000000000000000000000000000000000000000000002bb18f92100000000000000000000000000000000000000000000000000000002bb28208600000000000000000000000000000000000000000000000000000002bb39cee400000000000000000000000000000000000000000000000000000002bb8fc51dc0000000000000000000000000000000000000000000000000000002bb9e1abb00000000000000000000000000000000000000000000000000000002bbad33e800000000000000000000000000000000000000000000000000000002bbad33e800000000000000000000000000000000000000000000000000000002bbad33e800000000000000000000000000000000000000000000000000000002bbb5c92c00000000000000000000000000000000000000000000000000000002bbc462f700000000000000000000000000000000000000000000000000000002bbd541d000000000000000000000000000000000000000000000000000000002bbd541d000000000000000000000000000000000000000000000000000000002bbd7396f90000000000000000000000000000000000000000000000000000002bbd7b8fe80000000000000000000000000000000000000000000000000000002bbd7b8fe80000000000000000000000000000000000000000000000000000002bbd7b8fe80000000000000000000000000000000000000000000000000000002bbd7b8fe80000000000000000000000000000000000000000000000000000002bbd7b8fe80000000000000000000000000000000000000000000000000000002bbd8bced00000000000000000000000000000000000000000000000000000002bbd8c44000000000000000000000000000000000000000000000000000000002bbe003b800000000000000000000000000000000000000000000000000000002bbe006cf40000000000000000000000000000000000000000000000000000002bbe759a600000000000000000000000000000000000000000000000000000002bbef019c00000000000000000000000000000000000000000000000000000002bbef019c00000000000000000000000000000000000000000000000000000002bbef019c00000000000000000000000000000000000000000000000000000002bbf422be70000000000000000000000000000000000000000000000000000002bbf422be70000000000000000000000000000000000000000000000000000002bbf422be70000000000000000000000000000000000000000000000000000002bbf5d0c60';
    const metadata =
      '0x000000000000000000000000000000000000000000000000000000000000000001d7f07d114994b15449e5110e154fc52fd930b6a379d586d17e7423bf1046d2f21517be820c1428672d8bf0d2639ffacdd832426ca70038ca469f6123d265258d1b3c18fc1fb21beba85d814882752e7daf828f3c6bb86b709ad225e2f4b0f66eb20adf594c3e7dddfb66f08110d60ccabf5f73223449fa0d6428cca10a6b997e8c1cfef107cd2007537b6e4e8fa6af7f1221420e921c71c741af58d4aa33845d132e1d4af98631ca5f589ae7154c8030d5d5f9bda1f1fc8dbc1714f183027f8dfd901c8d7ee083d3930aadd63eb7ad12002b4a2b7589ccf62898474c9853539c9f36f97dd4c61113c4ab0a7194f259c99859bacd618d90a3863d74afe9b7449ad752841bb068d607814ecbc9f4bdde935b04f84a6d37ee1ee38048c1957588171d067f9e2982629acfc0cf2be925c577235fe8115cd2c45195cc4dfa11daf58a79a080c51c908f405fef0684bbd2f6b9ad9badcbeac014fb619ec22b2f49fc7a3f60a6b09527dd3161dcd1f4a207f00b3b8f2ef360a5375b903bbbb09026da0bcb05fba2061cb2f60fa8e0ff40329d9dd7c849502b508ee3f34c1c7eeb8a17e86c84c3e6030a105689f529fca921c8f61a46770c2db54689527674a797e208fc68d86a2b61821b3f923b5982de8b6fc2bacd20dc8f1fa312bf810c7ab9440da62884c8f69456821238345407499eaf98fbaea3fbe511306b5952795293cf25e68b1d45034bd0a21c262fbb2302ce05968fb5c8e3bb4e7418a20bfd4295f6184259dcfb5d9b1e107a2bd39c846c9111aea73161754fc4e91f893a2fe607e83683aeb82a48ede53cad1bd342710c6ee7a67b09336b8287f46910c0d0cec7dfcd72ec720ec06e3c460cc11808bffefd371ecd4d1c42624a5c89f932484211a960746035899b997ec1b0bd1bfcdf29892158711fe6c07fcb1be7ac269a745dd109a1b78d212173befc55487c7e455e67c8a980ffbe0be649a5384b1c54758f5a83f79d27de8048e8c807bcd41c000000000000000000000000cdef689d3098a796f840a26f383ce19f4f023b5b000000000000000000000000b7bea3a5d410f7c4ec2aa446ae4236f6eed6b16a000000000000000000000000cc1b49b86f79c7e50e294d3e3734fe94db9a42f0000000000000000000000000a4ebe1e06dd0bf674b0757cd20b97ee16b00af1b00000000000000000000000055048bc9f3a3f373031fb32c0d0d5c1bc6e10b3b0000000000000000000000008316e3eb7eccfcaf0c1967903cca8ecda3df37e0000000000000000000000000503bd542a29f089319855cd9f6f6f937c7be87c700000000000000000000000054103390874885e164d69bf08b6db480e5e8fe5d000000000000000000000000c01465eba4fa3a72309374bb67149a8fd14cb6870000000000000000000000000ac6c28b582016a55f6d4e3ac77b64749568ffe1000000000000000000000000beb19b5ec84ddc9426d84e5ce7403afb7bb56700';

    const signers = [
      '0x080D263FAA8CBd848f0b9B24B40e1f23EA06b3A3',
      '0xCdEf689d3098A796F840A26f383CE19F4f023B5B',
      '0xb7bEA3A5d410F7c4eC2aa446ae4236F6Eed6b16A',
      '0x5ba2D2B875626901fed647411AD08009b1ee35e2',
      '0x21389cBcdb25c8859c704BD8Cd7252902384FceF',
      '0x03A67cD8467642a03d5ebd67F97157931D94fA32',
      '0x3650Da40Fe97A93bfC2623E0DcA3899a91Eca0e2',
      '0x1F31c45AE0605690D63D26d7CdA4035c3668D473',
      '0xCc1b49B86F79C7E50E294D3e3734fe94DB9A42F0',
      '0xA4EBE1e06dd0bf674B0757cd20b97Ee16b00aF1B',
      '0x8d4AE8b06701f53f7a34421461441E4492E1C578',
      '0x5007b477F939646b4E4416AFcEf6b00567F5F078',
      '0x55048BC9f3a3f373031fB32C0D0d5C1Bc6E10B3b',
      '0x8316e3Eb7eccfCAF0c1967903CcA8ECda3dF37E0',
      '0x503bd542a29F089319855cd9F6F6F937C7Be87c7',
      '0xbd34530f411130fd7aCB88b8251009A0829379aA',
      '0x54103390874885e164d69bf08B6db480E5E8fE5d',
      '0xC01465eBA4FA3A72309374bb67149A8FD14Cb687',
      '0xAF447dA1E8c277C41983B1732BECF39129BE5CA6',
      '0xbe15B23E9F03e3Bb44c5E35549354649fb25b87B',
      '0x1E15545b23B831fD39e1d9579427DeA61425DD47',
      '0xD1C8b1e58C1186597D1897054b738c551ec74BD4',
      '0x8EB664cD767f12507E7e3864Ba5B7E925090A0E5',
      '0x656Fc633eb33cF5daD0bCEa0E42cde85fb7A4Ab8',
      '0x076b12D219a32613cd370eA9649a860114D3015e',
      '0x0ac6c28B582016A55f6d4e3aC77b64749568Ffe1',
      '0xD3b9610534994aAb2777D8Af6C41d1e54F2ef33f',
      '0xbeB19b5EC84DdC9426d84e5cE7403AFB7BB56700',
      '0xd54DDB3A256a40061C41Eb6ADF4f412ca8e17c25',
      '0xdb69C372B30D7A663BDE45d31a4886385F50Ea51',
      '0x67a95e050d2E4200808A488628d55269dDeFC455',
    ];

    const ORIGIN = 0;

    await ism.enrollValidators([ORIGIN], [signers]);
    await ism.setThreshold(ORIGIN, 1);

    expect(
      await ism.verify(
        metadata,
        utils.formatMessage(
          1, // version, unimportant
          1, // nonce, unimportant
          ORIGIN,
          Wallet.createRandom().address,
          1, // destination, unimportant
          Wallet.createRandom().address,
          report,
        ),
      ),
    ).to.eql(true);
  });
});
